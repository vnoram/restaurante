{% extends 'base.html' %}

{% block content %}
<div class="container mt-5 bg-light p-4 rounded shadow">
  <h1 class="text-center text-primary mb-4">Mis Compras</h1>
  <table class="table table-hover table-bordered">
      <thead class="table-success text-center">
          <tr>
              <th>ID de Compra</th>
              <th>Fecha</th>
              <th>Estado</th>
              <th>Total</th>
              <th>Detalle</th>
          </tr>
      </thead>
      <tbody>
          {% for compra in compras %}
          <tr>
              <td class="text-center">{{ compra.id }}</td>
              <td class="text-center">{{ compra.fecha }}</td>
              <td class="text-center {% if compra.estado == 'compra_cancelada' %}text-danger fw-bold{% elif compra.estado == 'terminado' %}text-success fw-bold{% else %}text-warning fw-bold{% endif %}">
                  {{ compra.get_estado_display }}
              </td>
              <td class="text-center fw-bold">${{ compra.total }}</td>
              <td>
                  <!-- BotÃ³n para ver detalles -->
                  <button class="btn btn-sm btn-info" type="button" data-bs-toggle="collapse" data-bs-target="#detalle-{{ compra.id }}" aria-expanded="false">
                      Ver Detalle
                  </button>
              </td>
          </tr>
          <tr>
              <td colspan="5" class="p-0">
                  <div class="collapse" id="detalle-{{ compra.id }}">
                      <table class="table table-sm table-striped m-0">
                          <thead class="table-secondary">
                              <tr>
                                  <th>Platillo</th>
                                  <th>Precio</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for pedido in compra.pedidos.all %}
                              <tr>
                                  <td>{{ pedido.platillo.nombre }}</td>
                                  <td>${{ pedido.platillo.precio }}</td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                  </div>
              </td>
          </tr>
          {% empty %}
          <tr>
              <td colspan="5" class="text-center text-danger">No tienes compras registradas.</td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
</div>

{% endblock %}
